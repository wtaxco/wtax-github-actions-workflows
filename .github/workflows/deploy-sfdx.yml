name: Deploy sfdx

on:
  workflow_call:
    inputs:
      run-tests:
        type: boolean
        required: true
    secrets:
      ansible-vault-password:
        required: true

jobs:
  # --- Developer ---
  deploy-dev:
    uses: ./.github/workflows/deploy-sfdx-project-to-developer.yml
    with:
      run-tests: ${{ inputs.run-tests }}
    secrets: inherit
    environment: developer   # requires approval in repo settings

  # --- UAT ---
  deploy-uat:
    needs: deploy-dev
    uses: ./.github/workflows/deploy-sfdx-project-to-uat.yml
    with:
      run-tests: true
    secrets: inherit
    environment: uat         # requires approval in repo settings

  # --- Production ---
  deploy-prod:
    needs: deploy-uat
    uses: ./.github/workflows/deploy-sfdx-project-to-prod.yml
    with:
      run-tests: true
    secrets: inherit
    environment: production  # requires approval in repo settings
