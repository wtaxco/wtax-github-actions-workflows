on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 3MVG9mVMtbWMH6luwQZnh1UwupxQxoca6H4Yu0gvsxQS7_yo6HdV00CFOw60m0aJFr6FvvHx9CwsTjg5Ybi_T
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.portalqa
      jwt-key-encrtypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: |
            $ANSIBLE_VAULT;1.1;AES256
            32373065343562656165343966343739653536626234346365313565333535386530396437373332
            3136633630636339636533643262316137356663306336300a626561636266303838323737656564
            63366563353062613463386630633433613634666630666265363265653735653036643130646532
            6362343564626263640a323139653538326365346539313636326132376366626136613935316237
            33306364336634373432633238346564643834343264376664303631393637636238646535396162
            39316239363861623865633034656131393332663239636666386136646631306238656362313965
            37636362363234303138383439653234373532366136366638383161306338303539633232313562
            31626465323736666338646162313031623036346235323131663936336234306335643564393462
            63646162333238333864376166323137623039366364333266363165363433396239363764623062
            38343736393438383764373463633234626666636638373832326338373737656463336631656466
            38356264386536616664376166353837613934656238633264393532306366383636613137336233
            30346365336636636364366630316238626339386130383738626437646136306661636637343161
            62303137326434663464363134646634616364616535396437653166623037313937626362363835
            33646562346339343265623534323638353634343339623436353335303134336136373266656662
            36646264383335396263373938353865663638353832336532633337343533323361336530373365
            36336433373663626565356564313933613636303636616563643735633661333138633133333239
            34336433386433343563656337353334353066323933353533343533616535326236323566396532
            62623964663132613236343063643930386666633561646162346162303832356566636638313961
            63313865393464333263303331396261336231353665316133336134613139616237613965363562
            35396465633166376163376431386630643364346638373130643137343732343966383661343332
            31663931313633336238653036316331313534383331366135656365386631363436363262313164
            32363030376139636531363662363663313830326336643231343338373630383239396466643061
            34363563313033346565343765323332646239303433366635623737613961363139373235313564
            65323065613965363232333634333165356331636239333032363035616138633733653962663866
            31643265323266383766366632616266613064386639616335366539313937373538626632373962
            36336639656263616363656438353034346665376661616261393930343838633133323066363939
            36376133373335626164306634363135303464623065643337323865363337333565643339363966
            64313733636539303361313933353032633266356530643066383834303366306463613638393335
            63336439336337633230633964373737316333663731313932373263376262666432383830396530
            31363861643038616562363963626439333463346330346234316166366138643264323365343839
            37313666336235636537386336626335366534363266626166356663366161383161636564653537
            34333932663332306237353237333935613434336632663539663761643763343635383339663133
            63373938326139643231643834396332396162326462353061323865313161303230386466636266
            35313864656234663738326563663466323236303934353366623266663235373162393532616334
            65343538356430653535653031343661396634656166393337646333353763376438323131653864
            37346332643835313338643337336461343962636138656661653630306632343137306337326236
            31613564386433306265373763613962376139623533333165646564366231616365666462633764
            38363362386462623762636261396261333239626334636661383334383561306466323937623861
            65323933666665613536393531376165613661373530653861386334646165633234383561346162
            36313035396131636364376534373631643137626139653330656263646337353437343733393839
            63646130306461663963653337373331396664373232633738666363336533633934663738366133
            32303732616361313331356235623639326435653631653865366361636363333539623261363638
            64393439373331643261613935316461383466336535663366373463646663363130346564643036
            32333063333362396434653836356263383266383234633434373434643763396536386134646231
            37333431393465356363613630346265376464343633353031333863346262663537353633623136
            37303066383163633361313166326563376336656430343764346363333662366334336662346135
            61666466643131633439326532393831333061343466363765393332393537633639383632343539
            37393565396330653232363031396138646364656232356134636333646432623263336337396435
            34303431646533313633313835653163653461343037613761303037383364616534666535613937
            34353530633432663235333431663866666164356530333463383866373962666237646562386338
            34653965363932383237613065343330306263383034613133366235356136313732343131303633
            66393531613030343866323732313262613361343637633039653833383830363037393333313238
            31623738613037343661323539636461323931386230646531653064306238663866323232316632
            63653433643033633363316639373161353032373861626439333261383331633763316366653034
            39366331646335363062373434373161333832663964393535353433343866646434656632643863
            36373163393762363539623565613330376136343535663132333033353130373766666363346339
            66653361363432373463326364343462303437623763313361646162656232626232396631306639
            62336564626139346134343762633337616235613835663837326463663337333866643266326634
            66326539333265656438613364633666653130343536623537343466313733333165333361396333
            66303639326365366338373138363264653038393464336339333361616139656366393864373836
            34636663636631376666633662346132313332303063323833313732303133313332343937373938
            31313833326335383839303839393136616533343464313862356234343332663735343331633233
            62613065663635303263653739333734303431376438653031333636623764626231383539663265
            33626333663538363463333962306361363532346639313837343032316532313438623632616464
            35326536353234316337386237633538393938663964623536346536623066356230383563363637
            30633533303738353162613765306362613264316431643463653233613565626466303464303637
            39363931346135386638353138376639326664663635313764386533306536303664333834396162
            34623032366464653436646338636239656261376339353265326635343731373833373633643966
            33356236666138316261336262656532366635306265363564663065393461666564623135386661
            63636534396364613634363038333331643037316663643439616230383932656236643239316366
            35613532656134633536313433323836626533646536316163346238623935326537663435663861
            64313838363463613233643039326132343165363635653433306361386231363539303132346636
            30613334373034306339333132643734306134633330663139303832383866653937353630666633
            63323963363438313362383263316335363133316266383561663063653938363933306432306561
            61386434303031353635373131343638393132386532643666313435396262323530393138633430
            66636339643463383764363130383735653833356534336132666634643261333133303864653234
            36626438613636333563376638366635663066383763623534616336383636386332653864313364
            39333064346664326166386137313139643031633830626233616665396636316362393633643365
            32666632383339393566346631333161313764316333636231626164666366323866313131333962
            64653230356133383363376530613038346237393231643865373163616334313533366235306233
            31386261303335353531626136623365653262363732616536306561306235653364303962613730
            63346633306565343963643430623062666437373631666361396363633837666234313866626364
            65643332303738643432316331346363616539623135393862363438313264393633666463363663
            33376166663962346534333865613432316163646235396430623032333830393634313837303439
            38626365313363363764613664656235656164313761373461626566353130366332636334313533
            39616631336261323036653839383866323132633036333763306432303437623236346239313230
            39666361646566333066356236636366316632353436383239636166313039306232333963343132
            61363832636532373263326162373332653361383831656134623939313839383764386665666161
            64366466623031663633323762396433363162353265333534633437316338353930
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@1.3.2
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-file: ${{ inputs.jwt-key-file }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
