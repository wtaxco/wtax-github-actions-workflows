on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 3MVG97srI77Z1g7..HvqYAA9TDgFxpfjJwjXeOaQsS0hPlSrps.2_ufvzRfPLdU8WzH5VsqZ2j1PWSfLHw12n
      jwt-key-encrypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: |
            $ANSIBLE_VAULT;1.1;AES256
            31613737363931376565633563656132646661303032363134326665333937356561666332336166
            3464666630326636636235663535613533303264343965630a646634393630366461366163383337
            39616337306333363862663462383033306665626332653465663765313763343734353465663139
            3638313035626431320a643066393364333234383231653864396331393932373365373062343138
            38363462613439373566343162663834633136636461663931343034383339653261393439313437
            65643631663032343738626161353766306363653138343235346537343136363633313064646461
            34616666383330653936336236633737303662393935643133633162646631626136636433386661
            64393266653431323638666539373965666634393237623739333038336235353861383135366238
            38356232373865643435613938663961623061626462613334363333636231613731313061613238
            32363634613663353065623762376638346133313830376162653663356533633261643964656232
            62623332343530363133623930643932376331636638353937656462623137386330373436616631
            66386432613636653136653330616562633236383433646433376163393735346330623363363932
            30393863343635646135346434346132303834653131613062323963666533653464653934336538
            38623533313333366538356264363164306230386532363438613138363365333564343262313666
            37356563656361653135643961356666333236613135633063663136636266636466663638663362
            35333535306338623564666162636239323337363439303637313138643039663336363630306131
            38663861313566343736626362353433376134383761323663333266656432613030643966363038
            30316434313763643837376635363334636333396339323431636235303964656336353065646536
            64633533383839303333393031356465356634356532666462653634303831396166313162626637
            37383635366534383935393864343739333835333766383730626163366366613963626230333636
            34373565313233303335393566303065636162333738636564363966316361626133623964643464
            31353535383736373065616665343836636134313962366561326435396130613932386535386630
            31306137303930633135333233373931636663643333613863366561616166633338323938383833
            39656636393439323065623234333233656166623332366430653632653165656639613532303166
            34353131663938316661656531623332303030643366356537613634383662653530313837366365
            35663864383466316331613632346261336363333765346661353336323832386232373362656261
            38373161653838346138333135386537356531653534663936366536346165633762633632663438
            65613232333037663733363538633232623436646633346264316164623462626231353434353061
            33306538363833323131326562633433373339386439663032663263646536613233356662313361
            33343862346539613133643262643138343737336162333036306333336165626136646364623263
            30663735353332363765343039623230643637346364613136633232653234356333396665643639
            66343230356138653932616539383565373336363565303635303866653263366435613135386535
            65366130316562356131313834376537303135313233313932333663366135343061616566656335
            64646230346239323535623132326434636665376538333461323064303064353636616437373063
            36633139366431316233376233323438393532376135656363323039633133656637653563663639
            66313534636561616634663439333032623236636433353432633162313538383730303638643434
            34633931616437626164623731333835376331613462396337373066386666363835616165663439
            37373731666437356635613339646663373633666332326334343463383232623934313834366539
            34656365346462323465646535346262376465613764623836323131323263656338333335366133
            34333365396439313066333132356536313339366632396631666261326364653463313130373433
            39323066646165626537333938396434306161356332396133656264356664666135363562363636
            35656164653361623763653665653062366430623832373033376635333438376230373330623134
            62346539313764356363393364366664303763326238653331643466646466353037323430326163
            31346235346137356133366233636563343963613565633037663330383135343437333731333739
            64393163393565646536376531656632636363633565343338633966373834323833633332346132
            33643063656534323136663735643331323064663035383338653933313463313464646261643735
            37336635633766643463386330346462313230616232323938396665616666643631346238616137
            30306232636539323030653536313230313664373335663838613766333738643264343064646261
            33353336313437323766393133393537343863616632646338393662313964383637323931633761
            30363062613433633533356261646239633131336163373132356662643561303135663537376663
            32383033613063363662326464643166333231343465376638653666303166383038366565353136
            35636163363633303130356634646239663165666439396532336233303334666265653930623161
            65323335323732653764393063333832376266623364623265303163633330363561333061366464
            37633732613436353832316237353330616437663238353361353131336332343764336561396533
            32353233663630333336313535376462356334653634333138393334313065313865346535333461
            36663038343763333334343564663139643235333235643966636130613931363837393636366430
            36653733623835356638613362343234323432303531306331383265636262666466626661303362
            62393566313662616634653337346135373434333930633936303232653031656364343865393730
            65376263353834383639316239353430636162376535313065386166663238613236653434353330
            35313037333331653162643837616238616538643165626439336163356230393761343239666633
            64336238343039323336353833636133643039343235613136336332613233643235313062623264
            30353030333334653933333261656230323130613936373134393037383730643833666233373861
            65633034383264363461616362663336643531386465613932663766646262633333323062383065
            61643237373936646261346461663537653235313534616664333763663231623163313235303530
            37343138626533613938626235386231363435663630333733643663386465666363306166303965
            61373762333036653836656432383133623835376561303461376363393038623063333363303862
            32646331393336396530383766393131366664306435633332396630373033663363373930623163
            38663663616232386265376432363664393966303433646138626335383330353533616164353066
            36643030656261343734656463393439623436653634626564643962363066326139336534313934
            38343832323761636161303935633263306336343632643030303739333636633362323839396265
            65303738383366626234353063383663363438333734363732626332663532313165643436613636
            39346464383563653664363933623539346332383362643538316562333039326136336136353639
            39333238323162336237633861373633313061383966646330333738326235663131643238336431
            38643636646138303066613532646136636364343830613462313438306234336564363061356638
            35396535303831613131326632313639363233336332303366323739323632633332373563383334
            39653138336135356662383134383864663633653963386166663636376433303138376230346366
            34613531636637633763663035616437313337393162336133363638366235333936333931326161
            62636434346434323338383866336664653735363765313264633037373835353330303637343036
            38343230656465346661373636333337633735646438393138343236376262303562633830303864
            62663765356430373261653034633561343265643932656136656139323731346639646561383962
            32653865306465653666623066633566383631396162323064363266303436373364316462313666
            66653263333865656166303739366235633664613431626334666437623731366666366131343766
            39376533376330656531373834363764363033333730663830333165643536356433383963363236
            38646465366465333030343537393937313733346230613563316135323632376166626331313866
            64303339363438383937323733373365646431653663313339653830386334613138313130376663
            30353138306561663833396131653930353233626365623263373239363966633532303665346333
            33316331316538346635353366623866306535363033396133366136313733636533303462323533
            64343137313736356266326263616634323363656437316234373533383836633564643466313239
            66353665626338346435313761656162643364363938376335303465336631633733
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.portalqa
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@testing
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-encrypted: ${{ inputs.jwt-key-encrypted }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
