on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 1c63CJDUKDLL2NGUFY583DNA.VVtm2f6.w8hOqPC3eY3of_1GNenYTWK2nQJv.OW9U6MqYrI_23BvN7rItrQV
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.portaldev
      jwt-key-encrypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: |
            $ANSIBLE_VAULT;1.1;AES256
            61633964663137303861656637363836663335306565646236303563373739653766656330623531
            3864663836616464373730306164323164643231363936340a613864663438343935346531386165
            31666130353337396638613235376433366630343031366635346439303064313864353762656231
            3135343734656562310a626661386461613731353961633164366565643764396335346262313566
            38356230366437323765323265373865356238666366363566303733306363616331643661356265
            66396532366135383237356539613266646537313763353130323738663936656331323363356163
            30356465636132646234313563383661306232353238616636313232363534323964633262323537
            61306565383338363233346435323836323662323833663964613439613538666439356330306636
            39623035323131383030333165393435306164326465663037666566376432336532386431363635
            62323962396661353830613431623030663630343030613864633638326335363339336630646232
            32613264376565653332616462396535646262343437643735373035366261303663343764663565
            31613462633336323065656633363335616234613238373939323664373330633130303930396464
            37656338656534323330383064373930393066393431633339316630333363323932343732626239
            65663966626565353966303763636539373339656635393264626565343937383665303738626635
            36656465656666343432373239353765376564663137623839396665353831356138343133323964
            64623265646664643031623731656230333636363838646336306463386564373334356230383061
            36613131333261666430323836616565656466613166306436396632663138653063633561653666
            37333163393562323963623833323965633263316563333039306236366162313835616563323561
            34323937316133366266643032373634623239636134653230616661313863346562613664376165
            36613539653863336562306135326665386435313932373130653232333533616630636437353766
            32616438376134653962353439393166316432376164303235306133376436656639636431636238
            35323730633331613830383631623037313162613634636162353637366465303161633039613533
            39653836396435653533643132363834326563633333303061633035616463613034633432383333
            63393963613632643034306530616335313865393666656265363635643139386266616266353433
            36663933616463343339613362623066353834343365383564376332636563363930313464633839
            34363633613165376531353462326530646162333931303738306239316538366530353166333935
            36656632396639373133326433663839616335663038333666363830323461656531326336643864
            39386235363566393661613966333261653132323437396236323338353439396161653330353432
            62366362663632393630396231353362646465663163303033363233656132613130633339366164
            37316239343465616232333765373366343934616630643433653465623539653531623832363534
            34623830623835643134316564343263303939666430306634376530383632336161633236393537
            39323937346464316530346264303336393463303932333532333434343338363330386534626635
            64383939633366396137363236653530666537623439663739333864393537386434373034343738
            33336561373638323363636338386332343138343738643039303430663837323734313235626137
            61306461343239653834633863333435326432343765353839316164333861646234653336633435
            62336363343864393836393631656531643039613066346464356661333738623163653534663938
            32336165386132383466613339666162373633373534353436643330386566653663306636663332
            63633135303133623765636365633839356434326233616364343731656239393161366462333163
            32643338626632633237313763333139353163376532373664626261343135393333336632653933
            35383263363864653239633462313236363762353963663535396561396261653531623639623834
            34663766353663633636653864656438613338376665646331663937336561343266386234323837
            37336438323830316262393465313437623735316535613837356138333332663530313163613237
            61323538616330353964356566613936623163313839326662613339643635323934396131663136
            62653031336531376566616263346534613165386366613832666539663939353336343131336433
            31396364623332663131306363373331386530356131663439363361336539386638303166366639
            38333736626436666562346235383961653063636263343632643136363833613838363132663739
            32643531626639613231323033373862343932653632633935663232656531643737396362613866
            34643462623532363761333464363530393266646663356138353032373535303738643531636163
            34636533626639363439303930356531626363633765373466633264373161396635636162613233
            64623833356232613937323536346534363038363466346233653966626665393430666434366137
            38393261366139656130323035306534353833313963326463613766366464643937663434323234
            33333438373433313834396631613739643665656564353535393536313834613261646661326166
            34363563313238623638623739383062633036306464396634313831626438323233383766313261
            66363061653663666539373036356630646331363335343638323736386534663339396139653735
            33643237636263306238356131623633626538393763653365303332363735393666373030396639
            62623064623465393735316330613065313835613030363165636332363533326465313032366339
            37303566613736663464343961356130313966363463356262383635613434333962656337383937
            38623039386434353765626333346431616533613133323234373038613232346631663064303964
            38356237613366303730323137653461376534386533613438663338303330333965646165306332
            32613138373834666434303632623036613839663830663563303439373062346534303137393939
            63393666356533373237353937343131336661316262356231656663646639353330343864323339
            30326434303161396134313939653737376639666162663336383432653434303462636137366164
            32386534373163363338623139393631333561343038383536626266633234393930393539633662
            32383637643433386137633861653263666636356162653165353734346464623633363631643663
            38326130633066636436356330333566336666326261313037363261653065643333353931353666
            31613163396261343230663035353362303232663562313533323439333635373231613165343139
            31663935643165326231653330393662626161663865393165373166366664313637643531303431
            64613930343634383738653734303937343230323363633465616664383936666564653736613633
            61643031373461323063353932626665366338613336653861386438313333383336346135623536
            35363765373839353332343634613465336638383831623965386530663461306539393332386434
            32386335653839393535646234613362303138316261356532613839383833386166656530613161
            37393038616239326663373364303435363833636637623761616561333537393338663439313233
            37373863616465633236616531636238323431613235306365663432666536326332373739653336
            65356562663036356661396563613138333138386435636362633232653566336365653336386634
            64396136323561636264633361366666303861373135366336333736303030313636386565623431
            31346530626437303539333936386534363932336133633739643236303762653633633866383437
            38356164363737313531623366613135316663333562343561383566383738343365313564363261
            31626461366462343363623535386263646230303135393661663938313164303066626566663835
            61633335333932616634636465366638383633613163303033663062633366343834356430623661
            63623265666665346230646437643038343764393532396332383266393063386534623637303364
            62336662383466363932653936386139383837623434616533343836333237376430323732353064
            38636139346636346361656366616137333538323136393034323339626431353937646361353836
            36353263663862373962356531373363366364363235373734396539366334333831343235363335
            65663333306233613564666437313531643239623134666538363264333965313739316361326565
            66343537633430666637306632653431393132396333613061373131343830656330356236396635
            64373062313862306431393938343861313765643233663737393139303962636334303139323233
            35313664353561383633343630663466383935316138363633366638393061383136366234383731
            31313333643436346135373636353337633335353232306664386238326463353932666238346161
            38666265336334313836356530663764666537393634313833333235646232613365
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@1.4.1
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-encrypted: ${{ inputs.jwt-key-encrypted }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
