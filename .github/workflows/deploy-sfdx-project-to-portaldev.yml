on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 3MVG9qwDmLOyLzAOVazTyHmmke2Vkic9PsMLQ7BfxKkivPfkldoKs2qOtEfdRuf9v3GFVttZeb9tusielqfbJ
      jwt-key-encrypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: |
            $ANSIBLE_VAULT;1.1;AES256
            36346561346331393464336538616661363564376264653363356166306562653261346463613262
            3230613539356536353664666539373938396531633633330a663739646566386437343432343730
            38623938643164383734383434353665653161653233383235613336636238616630393335653033
            6535376339356433630a393962366230633461313738353366643864316362623032343432363234
            34326532646233613730643163636339356436313937623035353763653838636566353935623939
            32313630306261333465613662303936363836663634623433383730376531373866383033393434
            39303837636365666461303434653238356634623030626334396363663931663865363565633438
            32343362656338383165633238393034623362353166323732316234363865393463613331373462
            32643861376438353133303866626666363537383431366538656663373161613632626262653133
            31393665373736323737303265326464306338313162633963353438376232653735626564326434
            39373863666264643832383134643639343835313635323430666437323462376162353333306539
            38363365613738333662653631656633613336616530366666306462323936323931346531353730
            65376139653539393339663564636535666237323963303162653637363438613335313237323262
            32636461373330356664363737646664376234643565303566363837336630653263343035643761
            32323433393263623935626434383432313839666437356464666532666361613530613763353166
            66663765326530366630623462333832393434323736313435313634363938623730366632343562
            62383231656333623736626537653335353634353364356233343630653030316633653464323437
            39383531303535653562653232626330383932346361646663376639306230643063326432323237
            37623336363737666463386663303130393037613534383433353134363664656431323563373466
            65323833613866303961643861663761303361633063323863383531393434316435306439623330
            32653335333730346238376538316365626230636531353230333339663536333738623466613264
            36386666663339656262346566633731316564386563343062633037316362633936356539363234
            36633962646263363030353737643234653439646436333164303036366533363965653561333531
            39666236653365623337336438303932623035346139383363623065343765333533343163333864
            30353533383366666361393564306163343463663339663537613765326636666630613030376235
            37656166303537613661613630323736363838373663613233366663373962316466303738343838
            32383461666332613563346162373639306434333933643131396336653330353965623434613763
            39666235363335643164646138666138363135653930363366326336653733383534346539313036
            64323763343431393462623163383938373438613138383038396438336435626562653939373664
            62386262663864643464306661633632653135646532663539616265383164363464393333656538
            61393162346664353030396562663033363663613830386339376233626631343333333661616635
            36666463336562343464626532613035353430623563373335316161383436663739643437326235
            63393735306430643331323464306236373961383230313332336230356632616638333135373565
            32366663326632316661356632333864323963623139643065336632306532363165303564353538
            33326632663262313032343830376531326362313061353766323437636636646233383065346333
            32656230636131383964643365623237303033383430663461636437383561356330626234383536
            34623363346331356262303530623633396465323230323062343337343065386234636135323466
            33353266633364653232666239663866643834373238353038616636393863323830313166366232
            63653537383733636262303839326234343665303632303565363633646535656533336538363630
            39353831393363653366643861373634316637373633333036666563386530616234333963346565
            33383665336462313866393831633436353134666463393731306664613466616564613065306531
            38366333613433313962323933323830356432366266326266336436653730306336353536666464
            33373864653031333939623761326433663461353239306662613063373566396461323832663566
            62323430323164393163386364643563643133646434353530336566356330373535633935323964
            32666362363764663736336462666438373436613936626561653636353462613931333165313962
            36363039366437376437643435326334626334363966346330323464373834336538396631306664
            61613333396661653536393936343638653263356134383537653566353237356430313966633939
            39663137623362613038626261396634616236383830376661333964333939666337396463373362
            31303231633066656137313339343434353335633365636262393731646363366436383164343930
            66383763303731333939316463303932616433646537663931306337346433336337366365353630
            37646262393461386166366261313263633135376561326564363233306536333335616134306439
            32363661636338636239343636336236643866356661373538376435326663373536386232626666
            63613461626338376462326437366433323165393331373566663361373738363563323330663964
            30386538313761653365626639643935333861396138393938626232636433643236363837363864
            62633635613637643036393763643566633563663536656432353064396464363765396235356238
            32336661346562613136396366313930663338613661306366303035633862336339633062386334
            35363638623538363933333834333862343334393932616163373737376563643465663165313130
            62353334623436346433653537663432646230636265356132663231633430303465383161343530
            30653666653434346662663562663661393335353138333830623536353737653935613361313666
            64366439636137653466393832363861306533393037333637383237396639306136653162633136
            34343736343238333164303764633135656461333962373364313737636636363461353365316664
            34386563343964353933623362303266643234326463323632666236653231373034386134666666
            32393038356136353937666336333666383836623761633361356635616237396662643066306566
            62616431663838636366323733396635386231393938643736363136653936663335306561353264
            39326461653430396634653231393165396635626137386565643736346431333566666138656536
            63653662366437363265363362343636663762386632373034386262633235326462363739653836
            39623234656463663935326532653038633339323331313139353638656636333536313636373933
            37653334363931393233343634633961623939343564323864656662326133633563363863376264
            66383464373132663935336436366638616238643264316163656436363839363535386136613231
            37373966383733623738333566316138613464383566363965396431646131633432303632356562
            66613833626537663037356537353062636336623931356333393137613963636365383735366134
            38623239363163373434316137336536366635646166363138626665373531383230636236613734
            31303436653930366437333933393832363032393863306665376564363561393066626430343966
            31653161646464643539393430376334323137356561323563336639323835636166643562636563
            30626662363962346265326265366431323235623234643363363031383566346534636263313633
            37343632306535396533633762646264653339653062333961326562643930663836653636333333
            64376435626661613430323431313832356562656264356133643662313766356133333631646362
            39303566396137373137613563366362363735303732303436663633646565373164666235386132
            39623030643364383133363465346164623231373238623931356262356462303365386361333436
            34373164396462373933623530323931613763623735323263363661363133353561633235613838
            63323238616234393434653163343730353865336235366433623663326635333465633763306236
            65666465393932306463663465646132666136633163326130646134383332623935663433303031
            31616162356139353138623836386439323333383235363838306532393261383533313761313466
            62393936393839643338663938383533613534643635656466333834643436643162313635333665
            31316232336536613739383333373739613339363535633933663337666661333531396139333039
            66346135396331306636353532386362653738303063656362666562346533633837623231316233
            65363536353866646462393063386135613761343666663437336536333230653030616532303732
            32373832626532373665636538643633363262303230643939356664336135316539623739363737
            61623037643065633436313466316465633439656464376136666334636337343762
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.portaldev
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@WSS-46-Apex-PMD-Sonar
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-encrypted: ${{ inputs.jwt-key-encrypted }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
