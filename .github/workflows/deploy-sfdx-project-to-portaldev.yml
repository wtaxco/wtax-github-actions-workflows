on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 1c63CJDUKDLL2NGUFY583DNA.VVtm2f6.w8hOqPC3eY3of_1GNenYTWK2nQJv.OW9U6MqYrI_23BvN7rItrQV
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.portaldev
      jwt-key-encrypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: >
            $ANSIBLE_VAULT;1.1;AES256
            30613236646138656239336131346233323661313864643939333131336638666434323937626334
            3533613234326666393565363638373363336662363736390a383332653239356566313632366634
            39643366373033396637376164623436363237616233636437373935323835323563633966326437
            6334623530613261380a333166383437633564643066323736313932653435386366343339323638
            34323561323139343863356133353430376535373466643533313066386630626434666539626661
            61636132336438356130316438333035386265643034323434303636666464633166363535303437
            64663631396437373065393436333364363039376132646430623865313230346235303838613531
            64653361393462646466336537383562356364326135356538316137653462356231333437313834
            36386165333662306332343337656135366566303233313433316566323938313230633031346666
            61393936666562646331326665333737653863326462613861326665373530633364323934646662
            61386530343062366465633837363536366230626234643131323834346161646530643535613730
            34633965353133323262396364353833373834323733386365323736636330643636343535373537
            30336439336530653134626437356564613530323137653030333035343738326565316262306334
            64616332373930663930383763653438336434313938646534636230383235666431373333616238
            30326230343465383635316362353232326462303535363933356564643864633663386135336664
            61343335616265303464616464346138333264356234343334393735613562346534663563353234
            36363663316434613730643130333837393539343033333330666433323565666330346133363330
            31643162313834313639356136633839363632303137396136626130366339333534643661366161
            62396635323737326365386330633563316365653634646563633938613231396537386563313764
            37663563656536343466613462336137646263336530383330356462623634653738623737383764
            63363235353865616235363139353261663636326337656335316538616666303234616137306664
            61326466376464623365336165616632393535383432333466633030643938383937653433623931
            34383661303434623265653733313936613435326333643464663231663132373233373563663533
            39386339353831313231643066323235323235366238316237383333623132303838653463336465
            66626335343466613162393336396537363161343862393266333237326238653334353965616439
            35613033366231613633626665346634333237353936346233326361356161313635323763323838
            38353161366465663532333135333130306361323830353166383261643061376239333739623064
            36303564363938353134313236633735323862343566386338636463663837633438666462646161
            34303338303265663839646233376361336331393366313237643032636336623239353836643438
            32616237306664623764663464663433373935666537666437663834323665303261336432646665
            31333662626535333731373066366132333861303637333764363739653730316366316635303937
            35336337623738643236343463343562323234373063376530613838353161353834613966656535
            38626530346436383933366661633162613737666339616461363536633034313139613364613861
            33396333626461353639623035653531333936373530613465646462643631356636653036633834
            62346165653066333164653065643365306232626130663839666138623563636565646266336434
            30653438316435663330323535653432333832643031353465633439643564613563313232366335
            62636631656633346266383736616466383964646537353765643838353964396639376231326338
            36653730343031373764666133663033643562396438343135636162366332393666633735343839
            30373861636365383333303734323738313737303636633863663161613638633234343235303333
            63376662643531343332613733336435616636316330646139643162663030663561383364353266
            66313538346235653730393839643166326663313536633537323634616439393765613238336364
            30663861656666613538626438643138623561653062643834653564376466373066646661313533
            65653433663238313035376233376439353433393361636261393463626165613164656365373834
            38663465663736633865336231616339613461633662313132323836623263363962326163366632
            35396561376636323934316564663932636332313461363036313639643238616662383134366338
            61353966333035346564613162373765316663376330636231663737643765373963643138663139
            30626631343338623037333939633364653733643661316230636362393661356566353164343933
            36316238343339326430643737663033633037383063666137353235303732303731623132346261
            32616439346562346536363465353332356462323964626361643664326239643239343063366234
            66626136303230376339366233636663363266396262346332346264326266336161653862633739
            31376338363861383339616166346261616461393835653732316335656439383363633165666430
            63366165323065656661613862323338303964316638373661386162326635646538626539656266
            63373636336165626564323162323232663263326438653538303732643833333636326334396336
            35393635346166653131633635613962633632313735373266313962316539376361323133343364
            62326137663731626261656239613736643038363835326435376438663231306563633837643638
            39303031643964623431363838623165616135643236306538383934666238663030376636653834
            65616534636338306561393366616334313932303663626461363535646634323865643066353565
            37656630336137343565616266373032666535653030336136633636313636613364303365653832
            32383839313233313530656239306439633561646633343466323765626234613263613963613334
            32353862633565383665363161616165353066396365343133363262373532626537663431653264
            34366466343665613330613830396537386533663161346135323536383530356131356430626263
            36363838303865356132613039336536653666613833313165626361663234313532626136373461
            31396231346637346561336439633034343562616162316234363535633761613466393632363134
            65386564303861356264653563633631663033333838343236633035316438306465663232646131
            62346633366364373535306437333636326232363662653938303738366562343931306636626562
            38393234356534623462303532646263326235323332633265616435643231393635333930373964
            31333165613735316236396162326235333633353933373830653231663165333232323333383366
            30653639343539316335343266666436616630366465633964306164373731623133656266373137
            39613830336363316531326663383732386664616664336633623938366265333436303235323662
            38356562633534393435646235663031613266666237656138366632663836383733633131633866
            34623230616632653838613534303739383965386163623930376463363039366536323265373938
            39643836643031653731366434383336626330646337626162393335353438656531393336363963
            38313665363833626263333739363436653130313632306665653565303633373234643761303038
            64623832643865363265363462373235333932306362396637343461313365323331663034396332
            64323662656264623734383265613938326533393339653136643035306131663633326633623065
            37623732623862626461613033313031343534353963626331353239656631666239363130623865
            63616136613261363666656239313063623164366631343632623339633336636231633736643830
            35333137653738653737653666353065623533653164633363326432396334323234353638303933
            39386333326531383665643566306661326632306439376331616339373764333835646361306664
            64306464613763393530653633366339666662373234646433383465316639353631643766626461
            64373965313064383637323838353362373335326137306563643064333032323431363361386264
            31633933363966666463303930393364636131646430343830646461626433336633656435393464
            63646531653034353265363738346465656634383836626437623930353063366235343138343234
            63666531346463376565613339356262656230616464363531643763666534373063386131363931
            63643334386533363930613437356331326361376432323463323962626365636266653864633233
            65326133306238633265336563353134373263356264386361306137333761363631353265326138
            37636263663738376335656264326538386532336536356535326535353966313230373232306339
            63363061616639626339363339323366343338336138376131353334373363633530386661653434
            35306664643638376538353865393930626162653834383164653861666139623639
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@1.4.1
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-encrypted: ${{ inputs.jwt-key-encrypted }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
