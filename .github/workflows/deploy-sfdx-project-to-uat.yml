on:
  workflow_call:
    inputs:
      instance-url:
        type: string
        description: Salesforce instance URL to log in to as Dev Hub org
        required: false
        default: https://test.salesforce.com
      client-id:
        type: string
        description: OAuth client ID (sometimes called consumer key) of the connected app on Salesforce used to connect to the Dev Hub org
        required: false
        default: 3MVG9DMdJCij4PmGRoL_xWsvynZ363dnIh_KEFDfNSNpx0MxOeGCaQJSTrJVWxncuIVGDn3mZucxszCY0UT73
      jwt-key-encrypted:
        type: string
        description: Ansible Vault-encrypted private key to connect to the target org with using the JWT flow (this should be encrypted using ansible-vault encrypt, NOT ansible-vault encrypt_string!)
        required: false
        default: |
            $ANSIBLE_VAULT;1.1;AES256
            33336661633038653664623238373937636237383766333565393337643637623939343466656235
            3861316136633361623964343934326137373537633636650a646532666532333032363961383765
            62626238353637316431313434636531313364303763353336663630623862356434393366386263
            3865656361343662610a646533333034626234353438663762646462616636363234323363613165
            61353336313535663236363536663236356531396265303534366635663930366434353266646639
            33353861643538393837316130393663333366363865366133663832353862323231646564356338
            62653064353438306664353432346139386130346661633865306266633565633637353365333039
            38613636613265363363326562363963613130333831626130633161343038633438653363343535
            38343634316366616432356561303632306338313032626531666661656661653430356665333861
            64663865383537366161316236346665653361343437356334346430343239656165393436356637
            64623865653838303366653766653866643936346361636239386663616635343163633538363364
            37373631393564353333373263636234393633363365383764313266643466623461363533303634
            61376535376530663633306230663534316638323538626232626631343764393031393439663563
            65356437303830643933346539633037613066353231363333666539623439373236353833633732
            33353035383762636630663961326163623266626139393265303531326665663630336236616363
            36306630343864336635316237653663393138373930666364376662613630343962303933333961
            33323639636130306163663038356135373935633066663036353235646335343962303931633263
            34643839383235356637626138316166346238366132346664396362663766346362623034653635
            66363130363839636238653236636264383861653538343738306436653264616562333164346161
            31393835646139626132626134613330386138366231336431653262303934363061336230353637
            61353638353561623062363332636265306231623465323936633635323562313039303536333431
            31646166643266336534666231303161623666376439373430373662333036346564626562386530
            66613464646164353764653139373664303732353739333666663137356232613861326532346438
            36396633393235333561383434336430663232633462336536353330393936393032366131663166
            33326562633664626339626163663165303334643664386337333932323361333466363431313833
            62393032623231353264376433656138336136386432393332643839393435633733653435346530
            31366464303032353933333063343562393733313662333835626463333833643463613932653161
            32336138313965613839333932343339323431353338643634346337663130353131656431383930
            39383537323638646365623263383434313638653165353263316337373764343736393032633963
            38336431633537396138343432613364343862346635633433386632396234636137393134646530
            34653834316439666463316533613334643561346630343263336633643039356336336536623133
            64336634643566643064343231613935666131626630626132303230636437353839326439613730
            30343566373763396137666235336364356464633035303539626633626636343333363461363063
            64393666343565363039383134623932643434373032323662656165396138623935383764656231
            62343336613233396165323038623466353132613430666430643066366265303137346462346638
            62653662363034323031333033383666313565396666323530396365653461366466633937383138
            33613933656335626531323934623331313132663064366563366661653662616330356533373733
            36363635393938616633383332666638303466346439383831376562346166353730616130666166
            39393365653034663231346435303334313363326132376235363638386662623466663539333234
            34623338316533353662316334613566666534643264363366363634363664333966396332656166
            39396631643165643561333832626363653732373866313237343732616238646433623963393966
            33623662336462323437643862626139613431386336346534303839666538343162653533633761
            31643730663034326163383662383237356165663564326433623932393335636331633662386230
            38396135396133646432643237323465376133323833366666613633373335336335386466346133
            34613032313761323837663037303265396337353065346664643130333834393665336634373963
            62646334666236313434356634646237326361323536383435636362646333393162313637386537
            31643766356462356361313038636361396366306162366466343330323330626234346665626462
            36653831646663313234393230343738333632663263316661333732613333636138656364386435
            36343466383362383634653961306431663837653534393835633263663936646437393165303934
            65616239373536666164313430323436306363623361363462316631343766313033623837396231
            37643931636365643462663737366233373239666361316431323739636262383863636331363063
            30666564653662643061343062346664636432643164363465396232613433393632633864333133
            64373637356437323931343962373432343565373130376533656631393638313733393939393462
            36666465626438376462333037323735363238326638303366643037363237313135663365383430
            37396561616362383037663065643533313631386465623463663737666365343437343861626663
            37643734386366353063616436313263323039383764383830356562666537383036636432353966
            38303436336665643663366163323030373834653939373336623835646632366265333132356332
            62343061666130633238393262346438653266383230376139623562663737336239396561353065
            64636365363065356336373065343835373532623931333262343364386534323732313633613130
            64613536343162303431343436633738663963663565656231316233656363666536383436646530
            62613339656138393166353564653465623437626435366138653236613232386466613338396165
            65336133336134633963616434383131386336643137643237386263636362343438313665356238
            32353766643666353164643265383466383361646637666632373139626265613664343439333461
            65616662393431336530616238353965346339613564316661313935653465633863326338346264
            38653232356434633735346461666234333338323433643937346539666633326336336163303935
            38343065316530363966373263343465396139303839333862316339393034623036666332633231
            35633262366164316364396238656639316137656430303662333464623564316635646664306364
            61373931316339303936336238333130333733316534373232313066653038366362633638633066
            30363838663031343539636162633632613132626666333139336539343830376465613730393463
            62383831313866666232623935623263313261646132303938386137393232333239363561393564
            34313839623263396564353634343565343630613038666634303463366664343939613638383536
            31303431313461313739646632376533373937643765636133663739386536613036306233623162
            66396439363863386261313265366436316337373935646337653535373739633133393861616438
            33653837323161356330363030366230333561313830393030393430373765336433356437633161
            64356533393938613162353834313731666532346361613532333132333763336231363062646237
            33633866303137316437303435613638393061636331383934306130636166333138383661343930
            38383261666264346166653232336262383862343961306531313937356630653237626264663964
            63363830663635393932343264366237386363623562633932643439643436663639383735346466
            31363637626232616539393636636436623533343065653432353739653132396630646265633463
            37323965623937353839656464616665393731313336393930353137326531613366323362386133
            65396566636262633036366461643765383835346233323434303132386630623139323532343432
            31373461663834343335346630313330303134636262386662306262303031643630313934363339
            30343530356237393439653831313932313364636562356566343062653538366462316138313236
            30363065646335653137616164353262373261373632393533666339383133393261323239333433
            63303733353834303530356436393436393863353936323636616563666163623931303361393338
            31373639643239373436353066623165343238326231613536383865366365343462633438653465
            38656564616538393636356466616139316437636138393739343936353332343661666234396538
            61646562643363633432
      username:
        type: string
        description: Username of Salesforce user to authenticate as; must have permission to create scratch orgs
        required: false
        default: admin@wtax.prod.uat
      run-tests:
        type: boolean
        description: Whether to run tests as part of the deployment. This is required when deploying to a production org.
        required: false
        default: true
    secrets:
      ansible-vault-password:
        description: Password to be used to decrypt the `jwt-key-encrypted`.
        required: true
jobs:
  deploy:
    uses: wtaxco/wtax-github-actions-workflows/.github/workflows/deploy-sfdx-project.yml@WSS-46-Apex-PMD-Sonar
    with:
      instance-url: ${{ inputs.instance-url }}
      client-id: ${{ inputs.client-id }}
      username: ${{ inputs.username }}
      jwt-key-encrypted: ${{ inputs.jwt-key-encrypted }}
      run-tests: ${{ inputs.run-tests }}
    secrets:
      ansible-vault-password: ${{ secrets.ansible-vault-password }}
